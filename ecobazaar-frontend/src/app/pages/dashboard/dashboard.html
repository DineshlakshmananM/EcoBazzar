<div class="max-w-5xl mx-auto px-6 py-10">

  <div class="mb-6">
    <h2 class="text-4xl font-extrabold text-green-700 flex items-center gap-3">
      Hello, {{ name }}
    </h2>
    <p class="text-gray-600 mt-2 text-lg">
      Role:
      <span class="font-semibold uppercase tracking-wide text-gray-800">
        {{ role }}
      </span>
    </p>
  </div>

  <div *ngIf="loading" class="flex justify-center my-8">
    <div class="loader">Loading...</div>
  </div>

  <div *ngIf="error" class="bg-red-100 text-red-700 p-4 rounded mb-6">
    {{ error }}
  </div>

  <ng-container *ngIf="!loading && report; else noData">

    <!-- Stats Grid -->
    <div class="grid lg:grid-cols-4 sm:grid-cols-2 gap-6 mb-10">
      <div class="bg-white border rounded-3xl p-6 shadow hover:shadow-xl transition-all">
        <div class="text-gray-500 text-sm">Total Purchases</div>
        <div class="text-4xl font-bold text-green-700 mt-3">{{ report.totalPurchase }}</div>
      </div>
      <div class="bg-white border rounded-3xl p-6 shadow hover:shadow-xl transition-all">
        <div class="text-gray-500 text-sm">Total Spent</div>
        <div class="text-3xl font-bold text-blue-600 mt-3">₹{{ report.totalSpent | number:'1.0-2' }}</div>
      </div>
      <div class="bg-white border rounded-3xl p-6 shadow hover:shadow-xl transition-all">
        <div class="text-gray-500 text-sm">Carbon Used</div>
        <div class="text-4xl font-bold text-red-600 mt-3">{{ report.totalCarbonUsed }} kg</div>
      </div>
      <div class="bg-white border rounded-3xl p-6 shadow hover:shadow-xl transition-all">
        <div class="text-gray-500 text-sm">Carbon Saved</div>
        <div class="text-4xl font-bold mt-3"
             [ngClass]="report.totalCarbonSaved > 0 ? 'text-emerald-600' : 'text-gray-400'">
          {{ report.totalCarbonSaved }} kg
        </div>
      </div>
    </div>

    <!-- Eco Badge -->
    <div class="relative overflow-hidden rounded-3xl p-6 shadow-xl text-white bg-gradient-to-r"
         [ngClass]="getBadgeColor()">
      <div class="relative z-10">
        <div class="text-white/90 text-sm">Eco Badge</div>
        <div class="text-3xl font-extrabold mt-3 drop-shadow">
          {{ report.totalCarbonSaved > 0 ? report.ecoBadge : 'No Eco Savings Yet' }}
        </div>
      </div>
    </div>

    <div *ngIf="report.totalCarbonSaved === 0" class="mt-3 text-gray-500 text-sm">
      You haven’t saved any carbon yet. Try eco-friendly products
    </div>

    <!-- Charts -->
    <div class="mt-8 bg-white border rounded-3xl p-6 shadow">
      <h3 class="text-lg font-semibold mb-4 text-green-700">Recent Carbon Saved</h3>
      <div style="height: 250px;"><canvas id="savedChart"></canvas></div>
    </div>

    <div class="mt-8 bg-white border rounded-3xl p-6 shadow">
      <h3 class="text-lg font-semibold mb-4 text-red-600 flex items-center gap-2">
        Carbon Used (Alarming)
      </h3>
      <div style="height: 250px;"><canvas id="usedChart"></canvas></div>
    </div>

    <!-- Action Buttons -->
    <div class="grid sm:grid-cols-2 gap-6 mt-12">
      <a routerLink="/products" class="flex justify-center items-center gap-2 py-4 rounded-2xl font-semibold shadow bg-green-600 text-white hover:bg-green-700 transition-all hover:scale-[1.02]">
        Browse Eco Products
      </a>
      <a routerLink="/cart" class="flex justify-center items-center gap-2 py-4 rounded-2xl font-semibold shadow bg-blue-600 text-white hover:bg-blue-700 transition-all hover:scale-[1.02]">
        Go to Cart
      </a>
    </div>

  </ng-container>

  <ng-template #noData>
    <div class="text-center py-12 text-gray-500">No report data available yet.</div>
  </ng-template>

  <!-- Become Admin Section (Only for USER role) -->
  <div class="mt-12 p-8 bg-gradient-to-r from-purple-600 to-indigo-600 rounded-3xl shadow-2xl text-white"
       *ngIf="role === 'USER'">
    <h3 class="text-2xl font-bold mb-4">Want to help moderate EcoBazzar?</h3>
    <p class="mb-6 opacity-90 text-lg">Apply to become an Admin. Our team will review your request shortly.</p>

    <div *ngIf="requestSuccess" class="mb-4 p-4 bg-green-500/30 rounded-xl border border-green-300">
      Request sent successfully! Please wait for approval.
    </div>

    <button (click)="requestAdminAccess()"
            [disabled]="requesting || hasPendingRequest"
            class="px-8 py-4 bg-white text-indigo-600 font-bold text-lg rounded-xl hover:bg-gray-100 transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg">
      <span *ngIf="!requesting && !hasPendingRequest">Become an Admin</span>
      <span *ngIf="hasPendingRequest" class="flex items-center gap-2">
        Request Pending...
      </span>
      <span *ngIf="requesting">Sending Request...</span>
    </button>
  </div>

  <!-- Become Seller Section (Only for normal USER) -->
  <div class="mt-12 p-8 bg-gradient-to-r from-teal-600 to-cyan-600 rounded-3xl shadow-2xl text-white"
       *ngIf="role === 'USER'">
    <h3 class="text-2xl font-bold mb-4">Want to sell eco-friendly products?</h3>
    <p class="mb-6 opacity-90 text-lg">Apply to become a Seller. Admin will review your request.</p>

    <div *ngIf="sellerRequestSuccess" class="mb-4 p-4 bg-green-500/30 rounded-xl border border-green-300">
      Request sent successfully! Awaiting admin approval.
    </div>

    <button (click)="requestSellerAccess()"
            [disabled]="sellerRequesting || hasPendingSellerRequest"
            class="px-8 py-4 bg-white text-cyan-600 font-bold text-lg rounded-xl hover:bg-gray-100 transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg">
      <span *ngIf="!sellerRequesting && !hasPendingSellerRequest">Become a Seller</span>
      <span *ngIf="hasPendingSellerRequest">Request Pending...</span>
      <span *ngIf="sellerRequesting">Sending...</span>
    </button>
  </div>

</div>